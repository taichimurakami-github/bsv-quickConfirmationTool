<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Balance and keys Quick Checker</title>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- <script src="https://unpkg.com/bsv@1.5.6/bsv.min.js"></script> -->
    <script src="./qrcode.min.js"></script>
    <script
      type="text/javascript"
      src="https://unpkg.com/bsv@1.5.3/bsv.min.js"
    ></script>
  </head>
  <body>
    <ul>
      <li>
        <input id="privatekey_input" />
        <button id="btn_checkout">確認する</button>
      </li>
      <li class="flex row">
        <p>Privkey:</p>
        <p id="privatekey" class="key-strings-container"></p>
      </li>
      <li class="flex row">
        <p>Pubkey:</p>
        <p id="publickey" class="key-strings-container"></p>
      </li>
      <li class="flex row">
        <p>address:</p>
        <p id="address" class="key-strings-container"></p>
      </li>
      <li class="flex row">
        <p>balance:</p>
        <p id="balance" class="key-strings-container"></p>
      </li>
    </ul>
    <div id="qrcode"></div>
    <p id="errorlog_showcase" class="error-container"></p>
  </body>
</html>
<style>
  .flex {
    display: flex;
  }
  .flex.row {
    justify-content: center;
    align-items: center;
    gap: 15px;
  }

  input {
    height: 1rem;
  }

  #errorlog_showcase {
    color: red;
    padding: 30px;
    text-align: center;
    font-weight: bold;
  }

  #qrcode {
    display: flex;
    margin-top: 50px;
    justify-content: center;
  }
</style>
<script>
  const btn = document.getElementById("btn_checkout");
  const privKeyElem = document.getElementById("privatekey");
  const pubKeyElem = document.getElementById("publickey");
  const addressElem = document.getElementById("address");
  const balanceElem = document.getElementById("balance");
  const errorlogElem = document.getElementById("errorlog_showcase");

  const refreshBalance = (addr) => {
    let config = {
      method: "get",
      url:
        "https://api.whatsonchain.com/v1/bsv/main/address/" + addr + "/balance",
    };

    axios(config).then((response) => {
      let data = JSON.stringify(response.data);
      console.log(data);
      balanceElem.innerText = data;
    });
  };

  btn.onclick = () => {
    try {
      const inputValue = document.getElementById("privatekey_input").value;

      const privKey = bsv.PrivateKey.fromString(inputValue);
      const pubKey = bsv.PublicKey.fromPrivateKey(privKey);
      const addr = bsv.Address.fromPrivateKey(privKey);
      privKeyElem.innerText = privKey;
      pubKeyElem.innerText = pubKey;
      addressElem.innerText = addr;
      balanceElem.innerText = "balance取得中...";

      refreshBalance(addr.toString());

      new QRCode(document.getElementById("qrcode"), `bitcoin: ${addr}`);
    } catch (e) {
      console.log(e);
      errorlogElem.innerText = e;
    }

    // refreshBalance();
  };
</script>
